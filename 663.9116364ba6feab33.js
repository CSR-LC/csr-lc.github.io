"use strict";(self.webpackChunklc_fe=self.webpackChunklc_fe||[]).push([[663],{663:(mt,M,s)=>{s.r(M),s.d(M,{AdminModule:()=>pt});var u=s(177),x=s(9329),y=s(1635),r=s(2973),S=s(7301),h=s(3487),f=s(8428),F=s(2578),e=s(7705),g=s(6132),R=s(8834),$=s(450);const N=function(){return[]};let p=class O{constructor(a){this.controller=a,this.columns=F.u,this.equipments$=this.controller.equipmentData$}ngOnInit(){this.controller.setPageHeader(),this.controller.fetchEquipments().subscribe(),this.equipmentCategories.pipe((0,S.s)(this)).subscribe(a=>this.controller.createCategoryDictionary(a)),this.equipmentStatuses.pipe((0,S.s)(this)).subscribe(a=>{this.controller.createStatusDictionary(a),this.controller.createEquipmentStatusIds(a)})}editEquipment(a){this.controller.manageEvent(a)}addNewEquipment(){this.controller.addNewEquipment()}setIsArchiveShown(a){this.controller.setIsArchiveShown(a)}static{this.\u0275fac=function(t){return new(t||O)(e.rXU(r.bW))}}static{this.\u0275cmp=e.VBU({type:O,selectors:[["lc-equipments"]],features:[e.Jv_([r.bW])],decls:10,vars:6,consts:[["color","primary",3,"change"],[3,"columns","limit","data","action"],["mat-raised-button","","color","primary",1,"add-equipment",3,"click"],[1,"content"]],template:function(t,n){1&t&&(e.j41(0,"section")(1,"mat-slide-toggle",0),e.bIt("change",function(l){return n.setIsArchiveShown(l.checked)}),e.EFF(2," \u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0430\u0440\u0445\u0438\u0432 "),e.k0s(),e.j41(3,"lc-table",1),e.bIt("action",function(l){return n.editEquipment(l)}),e.nI1(4,"async"),e.k0s(),e.j41(5,"button",2),e.bIt("click",function(){return n.addNewEquipment()}),e.j41(6,"div",3)(7,"span"),e.EFF(8,"+"),e.k0s(),e.EFF(9,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043e\u0431\u043e\u0440\u0443\u0434\u043e\u0432\u0430\u043d\u0438\u0435"),e.k0s()()()),2&t&&(e.R7$(3),e.Y8G("columns",n.columns)("limit",20)("data",e.bMT(4,3,n.equipments$)||e.lJ4(5,N)))},dependencies:[g.O,R.$z,$.sG,u.Jj],styles:["section[_ngcontent-%COMP%]{position:relative}mat-slide-toggle[_ngcontent-%COMP%]{position:absolute;top:7px;left:10px}lc-table[_ngcontent-%COMP%]{margin-bottom:30px}.add-equipment[_ngcontent-%COMP%]{position:fixed;bottom:24px;right:24px;height:56px;border-radius:28px;padding:20px}.add-equipment[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;align-items:center;color:#fff;font-size:14px;font-family:Roboto,serif;font-weight:400;text-transform:uppercase;line-height:24px;letter-spacing:1.25px;word-wrap:break-word}.add-equipment[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;font-weight:100;margin-right:8px}"],changeDetection:0})}};(0,y.Cg)([(0,h.l6)(f.WZ.equipmentCategories)],p.prototype,"equipmentCategories",void 0),(0,y.Cg)([(0,h.l6)(f.WZ.equipmentStatuses)],p.prototype,"equipmentStatuses",void 0),p=(0,y.Cg)([S.d],p);var m=s(1473),U=s(2917),v=s(6354),d=s(5558),V=s(4379),J=s(3573);let E=(()=>{class o{constructor(t,n){this.api=t,this.store=n}getEquipmentStatuses(){return this.api.getEquipmentStatuses().pipe((0,v.T)(t=>this.fillInStatusesTranslations(t)),(0,d.n)(t=>this.store.dispatch(new f.lx(t))),(0,v.T)(t=>t.application_data?.equipmentStatuses))}fillInStatusesTranslations(t){return t.map(n=>{const i=V.R[n.name];return i&&(n.translation=i),n})}getEquipmentCategories(){return this.api.getEquipmentCategories().pipe((0,d.n)(t=>this.store.dispatch(new f.ZC(t.items))),(0,v.T)(t=>t.application_data?.equipmentCategories))}static{this.\u0275fac=function(n){return new(n||o)(e.KVO(J.G),e.KVO(h.il))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac})}}return o})(),b=(()=>{class o{constructor(t){this.equipmentResolverService=t}resolve(){return this.equipmentResolverService.getEquipmentStatuses()}static{this.\u0275fac=function(n){return new(n||o)(e.KVO(E))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})(),A=(()=>{class o{constructor(t){this.equipmentResolverService=t}resolve(){return this.equipmentResolverService.getEquipmentCategories()}static{this.\u0275fac=function(n){return new(n||o)(e.KVO(E))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var z=s(8843),B=s(6473);const K=function(){return[]};let G=(()=>{class o{constructor(t){this.controller=t,this.columns=z.K,this.users$=this.controller.users$}ngOnInit(){this.controller.fetchUsers().subscribe(),this.controller.setPageTitle(B.n.Users)}editUser(t){this.controller.editUser(t)}static{this.\u0275fac=function(n){return new(n||o)(e.rXU(r.Tz))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["lc-users"]],features:[e.Jv_([r.Tz])],decls:2,vars:5,consts:[[3,"columns","data","action"]],template:function(n,i){1&n&&(e.j41(0,"lc-table",0),e.bIt("action",function(c){return i.editUser(c)}),e.nI1(1,"async"),e.k0s()),2&n&&e.Y8G("columns",i.columns)("data",e.bMT(1,2,i.users$)||e.lJ4(4,K))},dependencies:[g.O,u.Jj],changeDetection:0})}}return o})();var I=s(9261);const q=[{header:"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0430\u044f \u043f\u043e\u0447\u0442\u0430",columnDef:"email",style:{"minWidth.px":200}},{header:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f",columnDef:"surname",style:{"minWidth.px":200}},{header:"\u0418\u043c\u044f",columnDef:"name",style:{"minWidth.px":200}},{header:"\u0420\u043e\u043b\u044c",columnDef:"roleName",style:{"width.px":150}},{header:"",columnDef:I.ay.Delete,action:I.ay.Delete,tooltip:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435",style:{"width.px":32,"padding.px":0}}],W=function(){return[]};let H=(()=>{class o{constructor(t){this.controller=t,this.columns=q,this.data$=this.controller.roles$}ngOnInit(){this.controller.setPageTitle(),this.controller.fetchRoles().subscribe()}editRole(t){this.controller.manageEvent(t)}assignRole(){this.controller.assignRole()}static{this.\u0275fac=function(n){return new(n||o)(e.rXU(r.mT))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["lc-roles"]],features:[e.Jv_([r.mT])],decls:7,vars:6,consts:[[3,"columns","limit","data","action"],["mat-raised-button","","color","primary",1,"add-role",3,"click"],[1,"content"]],template:function(n,i){1&n&&(e.j41(0,"lc-table",0),e.bIt("action",function(c){return i.editRole(c)}),e.nI1(1,"async"),e.k0s(),e.j41(2,"button",1),e.bIt("click",function(){return i.assignRole()}),e.j41(3,"div",2)(4,"span"),e.EFF(5,"+"),e.k0s(),e.EFF(6,"\u041d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0440\u043e\u043b\u044c"),e.k0s()()),2&n&&e.Y8G("columns",i.columns)("limit",20)("data",e.bMT(1,3,i.data$)||e.lJ4(5,W))},dependencies:[g.O,R.$z,u.Jj],styles:[".add-role[_ngcontent-%COMP%]{position:fixed;bottom:24px;right:24px;height:56px;border-radius:28px;padding:20px}.add-role[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;align-items:center;color:#fff;font-size:14px;font-family:Roboto,serif;font-weight:400;text-transform:uppercase;line-height:24px;letter-spacing:1.25px;word-wrap:break-word}.add-role[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;font-weight:100;margin-right:8px}"],changeDetection:0})}}return o})();var Z=s(7224),Y=s(8141),L=s(4412),D=s(5964),Q=s(7673),w=s(4387),T=s(8313),k=s(915),_=s(4986),P=s(8736),C=s(4501),tt=s(5351),et=s(4571),nt=s(3269);let j=(()=>{class o{get applicationsData$(){return this.applicationsSub.asObservable()}constructor(t,n,i,l,c){this.api=t,this.dialog=n,this.store=i,this.notificationsService=l,this.mainPageHeaderService=c,this.applicationsSub=new L.t([])}get applicationStatuses(){return this.store.snapshot().application_data?.applicationStatuses||[]}setPageTitle(){this.mainPageHeaderService.setPageTitle("\u0417\u0430\u044f\u0432\u043a\u0438")}fetchApplications(){return this.api.getAllOrders().pipe((0,v.T)(t=>this.createRows(t.items)),(0,Y.M)(t=>this.applicationsSub.next(t)))}createRows(t){return t.map(n=>({entity:n,...n,...this.getUserInfo(n.user),...this.getEquipmentInfo(n.equipments),rentPeriod:this.getRentPeriodValue(n),status:this.getApplicationStatusName(n.last_status),actions:this.getRowActions(n)}))}getRowActions(t){const n=t.last_status.status;return{[T.v.more]:{tooltip:"",disabled:!1},[T.v.edit]:{tooltip:"",disabled:n===C.C.closed||n===C.C.rejected}}}getApplicationStatusName(t){return w.O[t.status]||""}getRentPeriodValue(t){const n=new Date(t.rent_start),i=new Date(t.rent_end);return`${n.getDate()}.${n.getMonth()+1}-${i.getDate()}.${i.getMonth()+1}`}getUserInfo(t){return{userName:t.name||"",userSurname:t.surname||"",userPhoneNumber:t.phone_number||""}}getEquipmentInfo(t){const n=t[0]||void 0;return{equipmentName:n?.name||"",equipmentTitle:n?.title||"",equipmentInventoryNumber:n?.inventoryNumber||""}}editApplication(t){t.action===T.v.edit&&this.editApplicationStatus(t.row.entity)}editApplicationStatus(t){let n;this.openEditApplicationStatusModal(t).pipe((0,D.p)(Boolean),(0,d.n)(i=>(n=i,this.checkNonChangeableStatuses(i))),(0,D.p)(Boolean),(0,d.n)(()=>{const i=this.getChangeStatusBody(t,n);return this.api.editApplicationStatus(i)}),(0,d.n)(()=>this.fetchApplications())).subscribe(()=>this.notificationsService.openSuccess("\u0421\u0442\u0430\u0442\u0443\u0441 \u0437\u0430\u044f\u0432\u043a\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d"))}checkNonChangeableStatuses(t){switch(t){case C.C.rejected:return this.openNotificationRejectedStatus();case C.C.closed:return this.openNotificationAboutClosedStatus();default:return(0,Q.of)(!0)}}openNotificationAboutClosedStatus(){return this.dialog.open(P.ZE,{width:"472px",data:{headerText:'\u0421\u0442\u0430\u0442\u0443\u0441 "\u0417\u0430\u043a\u0440\u044b\u0442\u043e"',infoMessage:'\u0415\u0441\u043b\u0438 \u0412\u044b \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u0435 \u0437\u0430\u044f\u0432\u043a\u0443 \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 "\u0417\u0430\u043a\u0440\u044b\u0442\u043e", \u0442\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u044d\u0442\u043e\u0439 \u0437\u0430\u044f\u0432\u043a\u0438 \u0432 \u0431\u0443\u0434\u0443\u0449\u0435\u043c \u0431\u0443\u0434\u0435\u0442 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e.',buttonOkText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",buttonCancelText:"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c"}}).afterClosed()}openNotificationRejectedStatus(){return this.dialog.open(P.ZE,{width:"472px",data:{headerText:'\u0421\u0442\u0430\u0442\u0443\u0441 "\u041e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u043e"',infoMessage:'\u0415\u0441\u043b\u0438 \u0412\u044b \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u0435 \u0437\u0430\u044f\u0432\u043a\u0443 \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 "\u041e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u043e", \u0442\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u044d\u0442\u043e\u0439 \u0437\u0430\u044f\u0432\u043a\u0438 \u0432 \u0431\u0443\u0434\u0443\u0449\u0435\u043c \u0431\u0443\u0434\u0435\u0442 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e.',buttonOkText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",buttonCancelText:"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c"}}).afterClosed()}getChangeStatusBody(t,n){return{comment:"comment",created_at:new Date,order_id:t.id,status:n}}openEditApplicationStatusModal(t){return this.dialog.open(k.qd,{..._.r,data:{application:t,statuses:this.applicationStatuses,statusTranslation:this.getApplicationStatusName(t.last_status),rentPeriod:this.getRentPeriodValue(t)}}).afterClosed()}static{this.\u0275fac=function(n){return new(n||o)(e.KVO(r.y6),e.KVO(tt.bZ),e.KVO(h.il),e.KVO(et.I),e.KVO(nt.j))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac})}}return o})();const st=function(){return[]},it=[{path:"",redirectTo:m.S.Equipments,pathMatch:"full"},{path:m.S.Equipments,resolve:{equipmentsStatuses:b,equipmentCategories:A},pathMatch:"full",component:p},{path:m.S.Users,pathMatch:"full",component:G},{path:m.S.Roles,resolve:{roles:(o,a,t=(0,e.WQX)(r.Fz))=>t.getRoles()},pathMatch:"full",component:H},{path:m.S.Applications,pathMatch:"full",component:(()=>{class o{get applications$(){return this.controller.applicationsData$}constructor(t){this.controller=t,this.columns=Z.e}ngOnInit(){this.controller.fetchApplications().subscribe(),this.controller.setPageTitle()}editApplication(t){this.controller.editApplication(t)}static{this.\u0275fac=function(n){return new(n||o)(e.rXU(j))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["lc-applications"]],features:[e.Jv_([j])],decls:2,vars:6,consts:[[3,"columns","limit","data","action"]],template:function(n,i){1&n&&(e.j41(0,"lc-table",0),e.bIt("action",function(c){return i.editApplication(c)}),e.nI1(1,"async"),e.k0s()),2&n&&e.Y8G("columns",i.columns)("limit",20)("data",e.bMT(1,3,i.applications$)||e.lJ4(5,st))},dependencies:[g.O,u.Jj],changeDetection:0})}}return o})()}];let at=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({providers:[U.f],imports:[x.iI.forChild(it),x.iI]})}}return o})();var rt=s(2201),lt=s(9417),ct=s(3434),ut=s(850);s(5781),s(1457),s(5129),s(6957),s(9087),s(9237),s(145),s(1529),s(8385),s(8449);let pt=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({providers:[r.y6,E,b,A,r.Fz,u.vh],imports:[u.MD,at,rt.G,lt.X1,ct._,ut.jL]})}}return o})()}}]);