import{a as Rt,b as R,c as X,d as F,e as k,f as $,g as B}from"./chunk-YBALBEJR.js";import{a as Dt}from"./chunk-7DQC5E6J.js";import{$c as xt,Hc as Q,Ib as _,J as at,Ja as N,Jc as At,K as d,Kb as dt,La as W,Lb as K,Na as ct,O as f,Pb as ft,Q as s,R as a,Ra as G,Sc as _t,Tc as b,Ua as O,Ub as ht,Vb as gt,W as p,Yb as q,Za as J,a as P,b as it,ca as M,d as ot,dc as Ct,f as I,g as nt,ga as h,gc as St,hb as lt,hc as U,i as A,ia as g,ic as vt,jc as w,k as V,kc as qt,lc as bt,ma as C,na as S,p as E,pc as yt,q as rt,sc as Et,t as l,u as T,va as v,w as n,wa as pt,wb as ut,wc as Mt,x as st,xa as mt,y as u,z as j}from"./chunk-LUI5EWE7.js";var kt=()=>[],x=class Y{constructor(r){this.controller=r,this.columns=bt,this.equipments$=this.controller.equipmentData$}ngOnInit(){this.controller.setPageHeader(),this.controller.fetchEquipments().subscribe(),this.equipmentCategories.pipe(K(this)).subscribe(r=>this.controller.createCategoryDictionary(r)),this.equipmentStatuses.pipe(K(this)).subscribe(r=>{this.controller.createStatusDictionary(r),this.controller.createEquipmentStatusIds(r)})}editEquipment(r){this.controller.manageEvent(r)}addNewEquipment(){this.controller.addNewEquipment()}setIsArchiveShown(r){this.controller.setIsArchiveShown(r)}static{this.\u0275fac=function(t){return new(t||Y)(d(F))}}static{this.\u0275cmp=u({type:Y,selectors:[["lc-equipments"]],features:[h([F])],decls:10,vars:6,consts:[["color","primary",3,"change"],[3,"action","columns","limit","data"],["mat-raised-button","","color","primary",1,"add-equipment",3,"click"],[1,"content"]],template:function(t,e){t&1&&(s(0,"section")(1,"mat-slide-toggle",0),p("change",function(m){return e.setIsArchiveShown(m.checked)}),M(2," \u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0430\u0440\u0445\u0438\u0432 "),a(),s(3,"lc-table",1),C(4,"async"),p("action",function(m){return e.editEquipment(m)}),a(),s(5,"button",2),p("click",function(){return e.addNewEquipment()}),s(6,"div",3)(7,"span"),M(8,"+"),a(),M(9,"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043E\u0431\u043E\u0440\u0443\u0434\u043E\u0432\u0430\u043D\u0438\u0435"),a()()()),t&2&&(at(3),f("columns",e.columns)("limit",20)("data",S(4,3,e.equipments$)||g(5,kt)))},dependencies:[b,O,Ct,v],styles:["section[_ngcontent-%COMP%]{position:relative}mat-slide-toggle[_ngcontent-%COMP%]{position:absolute;top:7px;left:10px}lc-table[_ngcontent-%COMP%]{margin-bottom:30px}.add-equipment[_ngcontent-%COMP%]{position:fixed;bottom:24px;right:24px;height:56px;border-radius:28px;padding:20px}.add-equipment[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;align-items:center;color:#fff;font-size:14px;font-family:Roboto,serif;font-weight:400;text-transform:uppercase;line-height:24px;letter-spacing:1.25px;word-wrap:break-word}.add-equipment[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;font-weight:100;margin-right:8px}"],changeDetection:0})}};I([W(q.equipmentCategories)],x.prototype,"equipmentCategories",void 0);I([W(q.equipmentStatuses)],x.prototype,"equipmentStatuses",void 0);x=I([dt],x);var D=(()=>{class i{constructor(t,e){this.api=t,this.store=e}getEquipmentStatuses(){return this.api.getEquipmentStatuses().pipe(A(t=>this.fillInStatusesTranslations(t)),E(t=>this.store.dispatch(new ht(t))),A(()=>this.store.selectSnapshot(q.equipmentStatuses)||[]))}fillInStatusesTranslations(t){return t.map(e=>{let o=yt[e.name];return o&&(e.translation=o),e})}getEquipmentCategories(){return this.api.getEquipmentCategories().pipe(E(t=>this.store.dispatch(new gt(t.items))),A(()=>this.store.selectSnapshot(q.equipmentCategories)||[]))}static{this.\u0275fac=function(e){return new(e||i)(n(R),n(N))}}static{this.\u0275prov=l({token:i,factory:i.\u0275fac})}}return i})();var L=(()=>{class i{constructor(t){this.equipmentResolverService=t}resolve(){return this.equipmentResolverService.getEquipmentStatuses()}static{this.\u0275fac=function(e){return new(e||i)(n(D))}}static{this.\u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var z=(()=>{class i{constructor(t){this.equipmentResolverService=t}resolve(){return this.equipmentResolverService.getEquipmentCategories()}static{this.\u0275fac=function(e){return new(e||i)(n(D))}}static{this.\u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Bt=()=>[],Pt=(()=>{class i{constructor(t){this.controller=t,this.columns=Et,this.users$=this.controller.users$}ngOnInit(){this.controller.fetchUsers().subscribe(),this.controller.setPageTitle(St.Users)}editUser(t){this.controller.editUser(t)}static{this.\u0275fac=function(e){return new(e||i)(d(k))}}static{this.\u0275cmp=u({type:i,selectors:[["lc-users"]],features:[h([k])],decls:2,vars:5,consts:[[3,"action","columns","data"]],template:function(e,o){e&1&&(s(0,"lc-table",0),C(1,"async"),p("action",function(y){return o.editUser(y)}),a()),e&2&&f("columns",o.columns)("data",S(1,2,o.users$)||g(4,Bt))},dependencies:[b,v],changeDetection:0})}}return i})();var It=[{header:"\u042D\u043B\u0435\u043A\u0442\u0440\u043E\u043D\u043D\u0430\u044F \u043F\u043E\u0447\u0442\u0430",columnDef:"email",style:{"minWidth.px":200}},{header:"\u0424\u0430\u043C\u0438\u043B\u0438\u044F",columnDef:"surname",style:{"minWidth.px":200}},{header:"\u0418\u043C\u044F",columnDef:"name",style:{"minWidth.px":200}},{header:"\u0420\u043E\u043B\u044C",columnDef:"roleName",style:{"width.px":150}},{header:"",columnDef:J.Delete,action:J.Delete,tooltip:"\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435",style:{"width.px":32,"padding.px":0}}];var Lt=()=>[],Tt=(()=>{class i{constructor(t){this.controller=t,this.columns=It,this.data$=this.controller.roles$}ngOnInit(){this.controller.setPageTitle(),this.controller.fetchRoles().subscribe()}editRole(t){this.controller.manageEvent(t)}assignRole(){this.controller.assignRole()}static{this.\u0275fac=function(e){return new(e||i)(d($))}}static{this.\u0275cmp=u({type:i,selectors:[["lc-roles"]],features:[h([$])],decls:7,vars:6,consts:[[3,"action","columns","limit","data"],["mat-raised-button","","color","primary",1,"add-role",3,"click"],[1,"content"]],template:function(e,o){e&1&&(s(0,"lc-table",0),C(1,"async"),p("action",function(y){return o.editRole(y)}),a(),s(2,"button",1),p("click",function(){return o.assignRole()}),s(3,"div",2)(4,"span"),M(5,"+"),a(),M(6,"\u041D\u0430\u0437\u043D\u0430\u0447\u0438\u0442\u044C \u0440\u043E\u043B\u044C"),a()()),e&2&&f("columns",o.columns)("limit",20)("data",S(1,3,o.data$)||g(5,Lt))},dependencies:[b,O,v],styles:[".add-role[_ngcontent-%COMP%]{position:fixed;bottom:24px;right:24px;height:56px;border-radius:28px;padding:20px}.add-role[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;align-items:center;color:#fff;font-size:14px;font-family:Roboto,serif;font-weight:400;text-transform:uppercase;line-height:24px;letter-spacing:1.25px;word-wrap:break-word}.add-role[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;font-weight:100;margin-right:8px}"],changeDetection:0})}}return i})();var jt=(i,r,t=st(B))=>t.getRoles();var H=(()=>{class i{get applicationsData$(){return this.applicationsSub.asObservable()}constructor(t,e,o,m,y,Ut){this.api=t,this.dialog=e,this.store=o,this.notificationsService=m,this.mainPageHeaderService=y,this.activatedRoute=Ut,this.applicationsSub=new ot([])}get applicationStatuses(){return this.store.selectSnapshot(q.applicationStatuses)||[]}setPageTitle(){this.mainPageHeaderService.setPageTitle("\u0417\u0430\u044F\u0432\u043A\u0438")}fetchApplications(){let t=this.activatedRoute.snapshot.queryParamMap.get(Mt.equipmentId);return this.api.getAllOrders(t).pipe(A(e=>this.createRows(e.items)),rt(e=>this.applicationsSub.next(e)))}createRows(t){return t.map(e=>it(P(P(P({entity:e},e),this.getUserInfo(e.user)),this.getEquipmentInfo(e.equipments)),{rentPeriod:this.getRentPeriodValue(e),status:this.getApplicationStatusName(e.last_status),actions:this.getRowActions(e)}))}getRowActions(t){let e=t.last_status.status;return{[U.more]:{tooltip:"",disabled:!1},[U.edit]:{tooltip:"",disabled:e===w.closed||e===w.rejected}}}getApplicationStatusName(t){return qt[t.status]||""}getRentPeriodValue(t){let e=new Date(t.rent_start),o=new Date(t.rent_end);return`${e.getDate()}.${e.getMonth()+1}-${o.getDate()}.${o.getMonth()+1}`}getUserInfo(t){return{userName:t.name||"",userSurname:t.surname||"",userPhoneNumber:t.phone_number||""}}getEquipmentInfo(t){let e=t[0]||void 0;return{equipmentName:e?.name||"",equipmentTitle:e?.title||"",equipmentInventoryNumber:e?.inventoryNumber||""}}editApplication(t){let e=t.row.entity;t.action===U.edit&&this.editApplicationStatus(e)}editApplicationStatus(t){let e;this.openEditApplicationStatusModal(t).pipe(V(Boolean),E(o=>(e=o,this.checkNonChangeableStatuses(o))),V(Boolean),E(()=>{let o=this.getChangeStatusBody(t,e);return this.api.editApplicationStatus(o)}),E(()=>this.fetchApplications())).subscribe(()=>this.notificationsService.openSuccess("\u0421\u0442\u0430\u0442\u0443\u0441 \u0437\u0430\u044F\u0432\u043A\u0438 \u0438\u0437\u043C\u0435\u043D\u0435\u043D"))}checkNonChangeableStatuses(t){switch(t){case w.rejected:return this.openNotificationRejectedStatus();case w.closed:return this.openNotificationAboutClosedStatus();default:return nt(!0)}}openNotificationAboutClosedStatus(){return this.dialog.open(Q,{width:"472px",data:{headerText:'\u0421\u0442\u0430\u0442\u0443\u0441 "\u0417\u0430\u043A\u0440\u044B\u0442\u043E"',infoMessage:'\u0415\u0441\u043B\u0438 \u0412\u044B \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u0435 \u0437\u0430\u044F\u0432\u043A\u0443 \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 "\u0417\u0430\u043A\u0440\u044B\u0442\u043E", \u0442\u043E \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u044D\u0442\u043E\u0439 \u0437\u0430\u044F\u0432\u043A\u0438 \u0432 \u0431\u0443\u0434\u0443\u0449\u0435\u043C \u0431\u0443\u0434\u0435\u0442 \u043D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E.',buttonOkText:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",buttonCancelText:"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C"}}).afterClosed()}openNotificationRejectedStatus(){return this.dialog.open(Q,{width:"472px",data:{headerText:'\u0421\u0442\u0430\u0442\u0443\u0441 "\u041E\u0442\u043A\u043B\u043E\u043D\u0435\u043D\u043E"',infoMessage:'\u0415\u0441\u043B\u0438 \u0412\u044B \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u0435 \u0437\u0430\u044F\u0432\u043A\u0443 \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 "\u041E\u0442\u043A\u043B\u043E\u043D\u0435\u043D\u043E", \u0442\u043E \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u044D\u0442\u043E\u0439 \u0437\u0430\u044F\u0432\u043A\u0438 \u0432 \u0431\u0443\u0434\u0443\u0449\u0435\u043C \u0431\u0443\u0434\u0435\u0442 \u043D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E.',buttonOkText:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",buttonCancelText:"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C"}}).afterClosed()}getChangeStatusBody(t,e){return{comment:"comment",created_at:new Date,order_id:t.id,status:e}}openEditApplicationStatusModal(t){return this.dialog.open(X,{data:{application:t,statuses:this.applicationStatuses,statusTranslation:this.getApplicationStatusName(t.last_status),rentPeriod:this.getRentPeriodValue(t)}}).afterClosed()}static{this.\u0275fac=function(e){return new(e||i)(n(R),n(lt),n(N),n(ft),n(At),n(ct))}}static{this.\u0275prov=l({token:i,factory:i.\u0275fac})}}return i})();var Ht=()=>[],Nt=(()=>{class i{get applications$(){return this.controller.applicationsData$}constructor(t){this.controller=t,this.columns=vt}ngOnInit(){this.controller.fetchApplications().subscribe(),this.controller.setPageTitle()}editApplication(t){this.controller.editApplication(t)}static{this.\u0275fac=function(e){return new(e||i)(d(H))}}static{this.\u0275cmp=u({type:i,selectors:[["lc-applications"]],features:[h([H])],decls:2,vars:6,consts:[[3,"action","columns","limit","data"]],template:function(e,o){e&1&&(s(0,"lc-table",0),C(1,"async"),p("action",function(y){return o.editApplication(y)}),a()),e&2&&f("columns",o.columns)("limit",20)("data",S(1,3,o.applications$)||g(5,Ht))},dependencies:[b,v],changeDetection:0})}}return i})();var Vt=[{path:"",redirectTo:_.Equipments,pathMatch:"full"},{path:_.Equipments,resolve:{equipmentsStatuses:L,equipmentCategories:z},pathMatch:"full",component:x},{path:_.Users,pathMatch:"full",component:Pt},{path:_.Roles,resolve:{roles:jt},pathMatch:"full",component:Tt},{path:_.Applications,pathMatch:"full",component:Nt}],Ot=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=j({type:i})}static{this.\u0275inj=T({providers:[Rt],imports:[G.forChild(Vt),G]})}}return i})();var Ei=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=j({type:i})}static{this.\u0275inj=T({providers:[R,D,L,z,B,pt],imports:[mt,Ot,xt,ut,Dt,_t]})}}return i})();export{Ei as AdminModule};
